# includeobj
standalone-версия макроса includeobj для подключения объектных файлов в формат PE FASM
## Краткое опеисание
Данный набор макросов реализует функицонал простого inline-линковщика для формата PE в FASM.  
Определяются макросы extrn и public, работающие идентично тому, как эти директивы работают в формате COFF.  
Так же реализуется макрос dllpublic, предназначенный для создания jmp-заглушек из библиотек dll.  
## Использование
1. Подготовка  
   Перед подключение includeobj.inc необходимо определить константу `__architecture` со значением x86/x64 для форматов PE/PE64 соответственно.
   Выглядеть это должно примерно так:
   ```asm
   define __architecture x86
   include "includeobj.inc"
   ```
2. includeobj  
   Этот макрос доступен в двух вариациях  
   `includeobj "yourobj.obj"`  
   `includeobj "yourobj.obj" as name`  
   В обоих случаях добавление обьектного файла в исходник происходить будет только если используются символы из него.  
   Однако во втором случае с помощью used вы можете проверить, был ли использован данный обьектник и, например, создать и экспортировать символы для него.  
   Выглядеть это будет примерно так:  
   ```asm
   includeobj "yourobj" as name
   if used name
     extVar dd 5
     public extVar
   end if
   ```
3. dllpublic  
   Макрос для jmp-заглушек при необходимости "плоского" импорта из dll.  
   Первый аргумент - символ, второй аргумент - целевая функция. Например  
   `dllpublic _printf, [printf]`  
   Сгенерирует следующий код  
   ```asm
   _printf:
      jmp [printf]
   ```  
   При условии, что ранее такой символ еще не был создан.  
   Потом созданный символ можно использовать для экспорта через public.
4. Режим отладки  
   С помощью определения однострочного макроса IOBJ_DBG вы можете включить отладочный режим для добавляемого обьектного файла.  
   Однако, так как часть информации выводится в postpone, пока что вам требуется сохранять этот макрос определенным, чтобы получить информацию о секциях и релокациях.  
   Это может быть исправлено в будущих версиях. По умолчанию в режиме отладки выводится только информация о секциях.  
   Далее перечислены все флаги отладочного режима, определяя которые вы можете управлять тем, какие именно данные будут выводиться. Флаги определяются с помощью define.  
4.1. IOBJ_DBG - включает режим отладки  
4.2. IOBJ_DBG_SHOW_STATIC - включает отображение статических символов из обьектного модуля.  
4.3. IOBJ_DBG_SHOW_PUBLIC - включает отображение экспортируемых из модуля символов.  
4.4. IOBJ_DBG_SHOW_DEBUG - включает отображение отладочных символов.  
4.5. IOBJ_DBG_SHOW_EXTRN - включает отображение импортируемых в модуль символов.  
4.6. IOBJ_DBG_SHOW_ABS - включает отображение абсолютных символов в модуле.  
4.7. IOBJ_DBG_SHOW_RELOCS - включает отображение релокаций.  
   Так же определены многострочные макросы @iobj_dbg_show_all и @iobj_dbg_hide_all, которые поднимают и опускают все указанные флаги соответственно.
5. Управление неинициализированными данными  
Все неинициализированные секции соединяются в одну последовательность.  
В случае, если область памяти для неинициализированных данных не была указана явно, они будут размещены в конце исполняемого файла.  
Указать область памяти для нецинициализированных данных можно с помощью многострочного макроса @init_bss.  
Указать эту область можно в любой момент, не обязательно в конце.  
